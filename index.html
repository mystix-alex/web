<!DOCTYPE html>
<html><head>
<meta charset="UTF-8">
<title>.</title>
<script>
// Étape 1 : Ouvrir une popup 1x1 hors écran
const p = window.open('','_blank','width=1,height=1,left=-9999,top=-9999,toolbar=0,menubar=0,location=0,status=0,scrollbars=0');

// Si popup bloquée → on arrête
if (!p) { document.body.innerHTML = "Activez les popups"; throw ""; }

// Étape 2 : Injecter le verrouillage dans la popup
p.document.write(`
<script>
let locked = false;
document.onkeydown = e => { if (e.key==='Escape' && locked) unlock(); };

function lock() {
  if (locked) return;
  locked = true;
  const b = e => { if (e.key !== 'Escape') { e.preventDefault(); e.stopPropagation(); } };
  ['keydown','keypress','keyup'].forEach(ev => document.addEventListener(ev, b, true));
  setTimeout(unlock, 4000);
}

function unlock() {
  if (!locked) return;
  locked = false;
  ['keydown','keypress','keyup'].forEach(ev => document.removeEventListener(ev, () => {}, true));
  setTimeout(() => window.close(), 50);
}

lock();
<\/script>
`);
p.document.close();

// Étape 3 : Fermer CETTE page immédiatement (0ms)
setTimeout(() => window.open('', '_self').close(), 0);
</script>
</head><body></body></html>
